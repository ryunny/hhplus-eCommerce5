-- ==================================================
-- EXPLAIN ANALYZE ì¸ë±ìŠ¤ ì„±ëŠ¥ ë¹„êµ í…ŒìŠ¤íŠ¸
-- ì¸ë±ìŠ¤ ì¶”ê°€ ì „í›„ ì„±ëŠ¥ì„ ì§ì ‘ ë¹„êµí•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±
-- ==================================================
-- ì‚¬ìš©ë²•:
-- 1. ì¸ë±ìŠ¤ ì œê±°: source drop_custom_indexes.sql;
-- 2. [1ë‹¨ê³„] ì¿¼ë¦¬ ì‹¤í–‰ìœ¼ë¡œ ì¸ë±ìŠ¤ ì—†ëŠ” ìƒíƒœ ì¸¡ì •
-- 3. [2ë‹¨ê³„] ì¸ë±ìŠ¤ ìƒì„±
-- 4. [3ë‹¨ê³„] ë™ì¼ ì¿¼ë¦¬ë¡œ ì¸ë±ìŠ¤ ìˆëŠ” ìƒíƒœ ì¸¡ì •
-- 5. ì‹¤í–‰ ì‹œê°„, ìŠ¤ìº” í–‰ ìˆ˜ ë¹„êµ
-- ==================================================

-- ==================================================
-- 1. ì¹´í…Œê³ ë¦¬ë³„ ìƒí’ˆ ì¡°íšŒ (ìƒí’ˆ ëª©ë¡ í˜ì´ì§€) â­ í•µì‹¬
-- ==================================================

-- [1ë‹¨ê³„] ì¸ë±ìŠ¤ ì—†ì´ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM products WHERE category_id = 1 LIMIT 20;

-> Limit: 20 row(s)  (cost=1031 rows=20) (actual time=0.0876..1.96 rows=20 loops=1)
    -> Filter: (products.category_id = 1)  (cost=1031 rows=1007) (actual time=0.0863..1.96 rows=20 loops=1)
        -> Table scan on products  (cost=1031 rows=10070) (actual time=0.0435..1.81 rows=2546 loops=1)


-- [2ë‹¨ê³„] ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_category_id ON products(category_id);

-- [3ë‹¨ê³„] ì¸ë±ìŠ¤ ìˆì„ ë•Œ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM products WHERE category_id = 1 LIMIT 20;

-> Limit: 20 row(s)  (cost=34.3 rows=20) (actual time=0.0297..0.0871 rows=20 loops=1)
    -> Index lookup on products using idx_category_id (category_id=1)  (cost=34.3 rows=98) (actual time=0.0288..0.0853 rows=20 loops=1)



-- [ë¹„êµ í¬ì¸íŠ¸]
-- - actual time: í’€ìŠ¤ìº” ì‹œê°„ â†’ ì¸ë±ìŠ¤ ìŠ¤ìº” ì‹œê°„
-- - rows: ì „ì²´ í…Œì´ë¸” ìŠ¤ìº” â†’ ì¹´í…Œê³ ë¦¬ë§Œ ìŠ¤ìº”
-- - type: ALL â†’ ref

-- ==================================================
-- 2. ì‚¬ìš©ìë³„ ì£¼ë¬¸ ëª©ë¡ ì¡°íšŒ (ë§ˆì´í˜ì´ì§€) â­ í•µì‹¬
-- ==================================================

-- [1ë‹¨ê³„] ì¸ë±ìŠ¤ ì—†ì´ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM orders
WHERE user_id = 1
ORDER BY created_at DESC
LIMIT 10;


-> Limit: 10 row(s)  (cost=1038 rows=10) (actual time=5.57..5.57 rows=4 loops=1)
    -> Sort: orders.created_at DESC, limit input to 10 row(s) per chunk  (cost=1038 rows=9973) (actual time=5.56..5.56 rows=4 loops=1)
        -> Filter: (orders.user_id = 1)  (cost=1038 rows=9973) (actual time=1.3..5.53 rows=4 loops=1)
            -> Table scan on orders  (cost=1038 rows=9973) (actual time=0.0938..5.17 rows=10000 loops=1)

-- [2ë‹¨ê³„] ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_user_id ON orders(user_id);

-> Limit: 10 row(s)  (cost=1.4 rows=4) (actual time=0.0661..0.0666 rows=4 loops=1)
    -> Sort: orders.created_at DESC, limit input to 10 row(s) per chunk  (cost=1.4 rows=4) (actual time=0.0652..0.0655 rows=4 loops=1)
        -> Index lookup on orders using idx_user_id (user_id=1)  (cost=1.4 rows=4) (actual time=0.0434..0.0503 rows=4 loops=1)

-- [3ë‹¨ê³„] ì¸ë±ìŠ¤ ìˆì„ ë•Œ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM orders
WHERE user_id = 1
ORDER BY created_at DESC
LIMIT 10;




-- [ë¹„êµ í¬ì¸íŠ¸]
-- - actual time: ì „ì²´ ì£¼ë¬¸ ìŠ¤ìº” â†’ ì‚¬ìš©ì ì£¼ë¬¸ë§Œ ìŠ¤ìº”
-- - rows: 10,000ê±´ â†’ ì‚¬ìš©ì ì£¼ë¬¸ ìˆ˜ë§Œí¼
-- - type: ALL â†’ ref

-- ==================================================
-- 3. ì‚¬ìš©ìë³„ íŠ¹ì • ìƒíƒœ ì£¼ë¬¸ ì¡°íšŒ â­â­ ë³µí•© ì¡°ê±´
-- ==================================================

-- [1ë‹¨ê³„] ì¸ë±ìŠ¤ ì—†ì´ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM orders
WHERE user_id = 1 AND status = 'SHIPPED'
ORDER BY created_at DESC;

-> Sort: orders.created_at DESC  (cost=1.04 rows=4) (actual time=0.0392..0.0392 rows=0 loops=1)
    -> Filter: (orders.`status` = 'SHIPPED')  (cost=1.04 rows=4) (actual time=0.0336..0.0336 rows=0 loops=1)
        -> Index lookup on orders using idx_user_id (user_id=1)  (cost=1.04 rows=4) (actual time=0.0237..0.0291 rows=4 loops=1)


-- [2ë‹¨ê³„] ì¸ë±ìŠ¤ ìƒì„± (user_idì™€ status ëª¨ë‘)
CREATE INDEX idx_user_id ON orders(user_id);
CREATE INDEX idx_status ON orders(status);


-- [3ë‹¨ê³„] ì¸ë±ìŠ¤ ìˆì„ ë•Œ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM orders
WHERE user_id = 1 AND status = 'SHIPPED'
ORDER BY created_at DESC;

-> Sort: orders.created_at DESC  (cost=1.07 rows=4) (actual time=0.0712..0.0712 rows=0 loops=1)
    -> Filter: (orders.`status` = 'SHIPPED')  (cost=1.07 rows=4) (actual time=0.0647..0.0647 rows=0 loops=1)
        -> Index lookup on orders using idx_user_id (user_id=1)  (cost=1.07 rows=4) (actual time=0.0525..0.0587 rows=4 loops=1)

-- [ë¹„êµ í¬ì¸íŠ¸]
-- - MySQLì´ idx_user_id ë˜ëŠ” idx_status ì„ íƒ
-- - ë³µí•© ì¡°ê±´ì—ì„œ ì¹´ë””ë„ë¦¬í‹° ë†’ì€ ì¸ë±ìŠ¤ ì‚¬ìš©

-- ==================================================
-- 4. ì£¼ë¬¸ ìƒíƒœë³„ ì¡°íšŒ (ê´€ë¦¬ì) â­
-- ==================================================

-- [1ë‹¨ê³„] ì¸ë±ìŠ¤ ì—†ì´ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM orders
WHERE status = 'DELIVERED'
AND created_at >= CURDATE()
LIMIT 100;

-> Limit: 100 row(s)  (cost=176 rows=100) (actual time=1.66..3.53 rows=10 loops=1)
    -> Filter: (orders.created_at >= <cache>(curdate()))  (cost=176 rows=554) (actual time=1.66..3.53 rows=10 loops=1)
        -> Index lookup on orders using idx_status (status='DELIVERED')  (cost=176 rows=1661) (actual time=0.0924..3.45 rows=1661 loops=1)


-- [2ë‹¨ê³„] ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_status ON orders(status);
CREATE INDEX idx_created_at ON orders(created_at);

-- [3ë‹¨ê³„] ì¸ë±ìŠ¤ ìˆì„ ë•Œ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM orders
WHERE status = 'DELIVERED'
AND created_at >= CURDATE()
LIMIT 100;

-> Limit: 100 row(s)  (cost=25 rows=9.16) (actual time=0.115..0.166 rows=10 loops=1)
    -> Filter: (orders.`status` = 'DELIVERED')  (cost=25 rows=9.16) (actual time=0.114..0.165 rows=10 loops=1)
        -> Index range scan on orders using idx_created_at over ('2025-11-20 00:00:00' <= created_at), with index condition: (orders.created_at >= <cache>(curdate()))  (cost=25 rows=55) (actual time=0.0835..0.16 rows=55 loops=1)


-- [ë¹„êµ í¬ì¸íŠ¸]
-- - ë³µí•© ì¡°ê±´: status + created_at
-- - MySQLì´ ì„ íƒë„ ë†’ì€ ì¸ë±ìŠ¤ ì„ íƒ

-- ==================================================
-- 5. íŠ¹ì • ê¸°ê°„ ì£¼ë¬¸ ì¡°íšŒ (ì›”ë³„ ë§¤ì¶œ) â­
-- ==================================================

-- [1ë‹¨ê³„] ì¸ë±ìŠ¤ ì—†ì´ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM orders
WHERE created_at BETWEEN '2025-01-01' AND '2025-01-31'
ORDER BY created_at DESC;



-- [2ë‹¨ê³„] ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_created_at ON orders(created_at);

-- [3ë‹¨ê³„] ì¸ë±ìŠ¤ ìˆì„ ë•Œ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM orders
WHERE created_at BETWEEN '2025-01-01' AND '2025-01-31'
ORDER BY created_at DESC;

-- [ë¹„êµ í¬ì¸íŠ¸]
-- - BETWEEN + ORDER BY ëª¨ë‘ ì¸ë±ìŠ¤ í™œìš©
-- - range íƒ€ì… ìŠ¤ìº”

-- ==================================================
-- 6. ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ (ì£¼ë¬¸ ìƒì„¸ í˜ì´ì§€) â­ í•µì‹¬
-- ==================================================

-- [1ë‹¨ê³„] ì¸ë±ìŠ¤ ì—†ì´ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT oi.*, p.name, p.price
FROM order_items oi
JOIN products p ON oi.product_id = p.id
WHERE oi.order_id = 1;

-> Nested loop inner join  (cost=3664 rows=2684) (actual time=6.53..8.37 rows=2 loops=1)
    -> Filter: (oi.order_id = 1)  (cost=2724 rows=2684) (actual time=6.48..8.3 rows=2 loops=1)
        -> Table scan on oi  (cost=2724 rows=26839) (actual time=0.497..7.4 rows=30000 loops=1)
    -> Single-row index lookup on p using PRIMARY (id=oi.product_id)  (cost=0.25 rows=1) (actual time=0.035..0.0351 rows=1 loops=2)


-- [2ë‹¨ê³„] ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_order_id ON order_items(order_id);
CREATE INDEX idx_product_id ON order_items(product_id);

-- [3ë‹¨ê³„] ì¸ë±ìŠ¤ ìˆì„ ë•Œ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT oi.*, p.name, p.price
FROM order_items oi
JOIN products p ON oi.product_id = p.id
WHERE oi.order_id = 1;


-> Nested loop inner join  (cost=1.4 rows=2) (actual time=0.0699..0.0779 rows=2 loops=1)
    -> Index lookup on oi using idx_order_id (order_id=1)  (cost=0.7 rows=2) (actual time=0.0536..0.0564 rows=2 loops=1)
    -> Single-row index lookup on p using PRIMARY (id=oi.product_id)  (cost=0.3 rows=1) (actual time=0.00917..0.00921 rows=1 loops=2)

-- [ë¹„êµ í¬ì¸íŠ¸]
-- - order_items í…Œì´ë¸” ìŠ¤ìº” ë°©ì‹ ë³€í™”
-- - JOIN ì„±ëŠ¥ ê°œì„ 

-- ==================================================
-- 8. ì£¼ë¬¸ì˜ ê²°ì œ ì •ë³´ ì¡°íšŒ (ê²°ì œ ìƒì„¸) â­ í•µì‹¬
-- ==================================================

-- [1ë‹¨ê³„] ì¸ë±ìŠ¤ ì—†ì´ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM payments WHERE order_id = 1;

-> Filter: (payments.order_id = 1)  (cost=975 rows=950) (actual time=0.0947..2.65 rows=1 loops=1)
    -> Table scan on payments  (cost=975 rows=9504) (actual time=0.0934..2.33 rows=10000 loops=1)


-- [2ë‹¨ê³„] ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_order_id ON payments(order_id);

-- [3ë‹¨ê³„] ì¸ë±ìŠ¤ ìˆì„ ë•Œ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM payments WHERE order_id = 1;


-> Index lookup on payments using idx_order_id (order_id=1)  (cost=0.35 rows=1) (actual time=0.0284..0.0304 rows=1 loops=1)



-- [ë¹„êµ í¬ì¸íŠ¸]
-- - 1:1 ê´€ê³„ ì¡°íšŒ ìµœì í™”
-- - order_id UNIQUE ì œì•½ íš¨ê³¼

-- ==================================================
-- 9. ê²°ì œ ìƒíƒœë³„ ì¡°íšŒ (ì •ì‚° ì²˜ë¦¬) â­
-- ==================================================

-- [1ë‹¨ê³„] ì¸ë±ìŠ¤ ì—†ì´ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM payments
WHERE status = 'COMPLETED'
LIMIT 100;

-> Limit: 100 row(s)  (cost=975 rows=100) (actual time=0.11..0.259 rows=100 loops=1)
    -> Filter: (payments.`status` = 'COMPLETED')  (cost=975 rows=950) (actual time=0.11..0.254 rows=100 loops=1)
        -> Table scan on payments  (cost=975 rows=9504) (actual time=0.103..0.219 rows=402 loops=1)


-- [2ë‹¨ê³„] ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_status ON payments(status);

-- [3ë‹¨ê³„] ì¸ë±ìŠ¤ ìˆì„ ë•Œ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM payments
WHERE status = 'COMPLETED'
LIMIT 100;

-> Limit: 100 row(s)  (cost=323 rows=100) (actual time=0.581..0.593 rows=100 loops=1)
    -> Index lookup on payments using idx_status (status='COMPLETED')  (cost=323 rows=2498) (actual time=0.58..0.589 rows=100 loops=1)


-- [ë¹„êµ í¬ì¸íŠ¸]
-- - ENUM íƒ€ì… ì»¬ëŸ¼ ì¸ë±ìŠ¤ íš¨ê³¼
-- - ë°°ì¹˜ ì²˜ë¦¬ ì¿¼ë¦¬ ìµœì í™”

-- ==================================================
-- 10. ë°ì´í„° ì „ì†¡ ì‹¤íŒ¨ ê±´ ì¡°íšŒ (ì¬ì „ì†¡ ì²˜ë¦¬) â­
-- ==================================================

-- [1ë‹¨ê³„] ì¸ë±ìŠ¤ ì—†ì´ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM payments
WHERE data_transmission_status = 'FAILED'
LIMIT 50;

-> Limit: 50 row(s)  (cost=975 rows=50) (actual time=0.0912..0.11 rows=50 loops=1)
    -> Filter: (payments.data_transmission_status = 'FAILED')  (cost=975 rows=950) (actual time=0.0907..0.108 rows=50 loops=1)
        -> Table scan on payments  (cost=975 rows=9504) (actual time=0.0867..0.0975 rows=128 loops=1)


-- [2ë‹¨ê³„] ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_data_transmission_status ON payments(data_transmission_status);

-- [3ë‹¨ê³„] ì¸ë±ìŠ¤ ìˆì„ ë•Œ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM payments
WHERE data_transmission_status = 'FAILED'
LIMIT 50;

-> Limit: 50 row(s)  (cost=401 rows=50) (actual time=0.307..0.313 rows=50 loops=1)
    -> Index lookup on payments using idx_data_transmission_status (data_transmission_status='FAILED')  (cost=401 rows=3284) (actual time=0.306..0.311 rows=50 loops=1)


-- [ë¹„êµ í¬ì¸íŠ¸]
-- - ì‹¤íŒ¨ ê±´ë§Œ ë¹ ë¥´ê²Œ í•„í„°ë§
-- - ë°°ì¹˜ ì¬ì²˜ë¦¬ ì„±ëŠ¥



-- ==================================================
-- 12. íŠ¹ì • íƒ€ì… ì¿ í° ì¡°íšŒ â­
-- ==================================================

-- [1ë‹¨ê³„] ì¸ë±ìŠ¤ ì—†ì´ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM coupons
WHERE coupon_type = 'PERCENTAGE'
AND start_date <= NOW()
AND end_date >= NOW();

-> Filter: ((coupons.coupon_type = 'PERCENTAGE') and (coupons.start_date <= <cache>(now())) and (coupons.end_date >= <cache>(now())))  (cost=92.9 rows=11.1) (actual time=0.0915..0.512 rows=495 loops=1)
    -> Table scan on coupons  (cost=92.9 rows=1000) (actual time=0.0625..0.385 rows=1000 loops=1)


-- [2ë‹¨ê³„] ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_type ON coupons(coupon_type);
CREATE INDEX idx_dates ON coupons(start_date, end_date);

-- [3ë‹¨ê³„] ì¸ë±ìŠ¤ ìˆì„ ë•Œ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM coupons
WHERE coupon_type = 'PERCENTAGE'
AND start_date <= NOW()
AND end_date >= NOW();


-> Filter: ((coupons.start_date <= <cache>(now())) and (coupons.end_date >= <cache>(now())))  (cost=22 rows=167) (actual time=0.0971..0.859 rows=495 loops=1)
    -> Index lookup on coupons using idx_type (coupon_type='PERCENTAGE')  (cost=22 rows=502) (actual time=0.0929..0.813 rows=502 loops=1)

-- [ë¹„êµ í¬ì¸íŠ¸]
-- - ë‹¤ì¤‘ ì¡°ê±´ì—ì„œ ì¸ë±ìŠ¤ ì„ íƒ
-- - type + dates ì¡°í•©

-- ==================================================
-- 13. ì‚¬ìš©ìì˜ ì‚¬ìš© ê°€ëŠ¥ ì¿ í° ì¡°íšŒ (ê²°ì œ í˜ì´ì§€) â­â­ í•µì‹¬
-- ==================================================

-- [1ë‹¨ê³„] ì¸ë±ìŠ¤ ì—†ì´ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT uc.*, c.name, c.discount_rate, c.discount_amount
FROM user_coupons uc
JOIN coupons c ON uc.coupon_id = c.id
WHERE uc.user_id = 1 AND uc.status = 'AVAILABLE';


-> Nested loop inner join  (cost=519 rows=49.6) (actual time=1.33..1.33 rows=0 loops=1)
    -> Filter: ((uc.user_id = 1) and (uc.`status` = 'AVAILABLE'))  (cost=502 rows=49.6) (actual time=1.33..1.33 rows=0 loops=1)
        -> Table scan on uc  (cost=502 rows=4964) (actual time=0.0968..1.11 rows=5000 loops=1)
    -> Single-row index lookup on c using PRIMARY (id=uc.coupon_id)  (cost=0.252 rows=1) (never executed)

-- [2ë‹¨ê³„] ë³µí•© ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_user_status ON user_coupons(user_id, status);

-- [3ë‹¨ê³„] ì¸ë±ìŠ¤ ìˆì„ ë•Œ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT uc.*, c.name, c.discount_rate, c.discount_amount
FROM user_coupons uc
JOIN coupons c ON uc.coupon_id = c.id
WHERE uc.user_id = 1 AND uc.status = 'AVAILABLE';

-> Nested loop inner join  (cost=0.7 rows=1) (actual time=0.014..0.014 rows=0 loops=1)
    -> Index lookup on uc using idx_user_status (user_id=1, status='AVAILABLE')  (cost=0.35 rows=1) (actual time=0.0129..0.0129 rows=0 loops=1)
    -> Single-row index lookup on c using PRIMARY (id=uc.coupon_id)  (cost=0.35 rows=1) (never executed)


-- [ë¹„êµ í¬ì¸íŠ¸]
-- - ë³µí•© ì¸ë±ìŠ¤ (user_id, status) íš¨ê³¼
-- - WHERE ë‘ ì¡°ê±´ ëª¨ë‘ ì¸ë±ìŠ¤ í™œìš©

-- ==================================================
-- 14. íŠ¹ì • ì¿ í°ì˜ ë°œê¸‰ ë‚´ì—­ ì¡°íšŒ (ì¿ í° ê´€ë¦¬) â­
-- ==================================================

-- [1ë‹¨ê³„] ì¸ë±ìŠ¤ ì—†ì´ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT uc.*, u.name, u.email
FROM user_coupons uc
JOIN users u ON uc.user_id = u.id
WHERE uc.coupon_id = 1
LIMIT 100;

-> Limit: 100 row(s)  (cost=676 rows=100) (actual time=0.48..2.43 rows=8 loops=1)
    -> Nested loop inner join  (cost=676 rows=496) (actual time=0.478..2.42 rows=8 loops=1)
        -> Filter: (uc.coupon_id = 1)  (cost=502 rows=496) (actual time=0.456..2.35 rows=8 loops=1)
            -> Table scan on uc  (cost=502 rows=4964) (actual time=0.174..2.14 rows=5000 loops=1)
        -> Single-row index lookup on u using PRIMARY (id=uc.user_id)  (cost=0.25 rows=1) (actual time=0.00847..0.00851 rows=1 loops=8)

-- [2ë‹¨ê³„] ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_coupon_id ON user_coupons(coupon_id);

-- [3ë‹¨ê³„] ì¸ë±ìŠ¤ ìˆì„ ë•Œ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT uc.*, u.name, u.email
FROM user_coupons uc
JOIN users u ON uc.user_id = u.id
WHERE uc.coupon_id = 1
LIMIT 100;


-> Limit: 100 row(s)  (cost=5.6 rows=8) (actual time=0.047..0.0666 rows=8 loops=1)
    -> Nested loop inner join  (cost=5.6 rows=8) (actual time=0.0465..0.0658 rows=8 loops=1)
        -> Index lookup on uc using idx_coupon_id (coupon_id=1)  (cost=2.8 rows=8) (actual time=0.0389..0.0416 rows=8 loops=1)
        -> Single-row index lookup on u using PRIMARY (id=uc.user_id)  (cost=0.263 rows=1) (actual time=0.00274..0.00276 rows=1 loops=8)

-- [ë¹„êµ í¬ì¸íŠ¸]
-- - ì¿ í°ë³„ ë°œê¸‰ ë‚´ì—­ í•„í„°ë§
-- - JOIN ì„±ëŠ¥ ê°œì„ 

-- ==================================================
-- 15. ë§Œë£Œ ì„ë°• ì¿ í° ì¡°íšŒ (ì•Œë¦¼ ë°œì†¡ìš©) â­
-- ==================================================

-- [1ë‹¨ê³„] ì¸ë±ìŠ¤ ì—†ì´ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT uc.*, u.name, c.name as coupon_name
FROM user_coupons uc
JOIN users u ON uc.user_id = u.id
JOIN coupons c ON uc.coupon_id = c.id
WHERE uc.expires_at BETWEEN NOW() AND DATE_ADD(NOW(), INTERVAL 7 DAY)
AND uc.status = 'AVAILABLE'
LIMIT 100;

-> Limit: 100 row(s)  (cost=496 rows=55.2) (actual time=0.264..1.85 rows=100 loops=1)
    -> Nested loop inner join  (cost=496 rows=55.2) (actual time=0.263..1.85 rows=100 loops=1)
        -> Nested loop inner join  (cost=477 rows=55.2) (actual time=0.23..1.51 rows=100 loops=1)
            -> Filter: ((uc.expires_at between <cache>(now()) and <cache>((now() + interval 7 day))) and (uc.`status` = 'AVAILABLE'))  (cost=458 rows=55.2) (actual time=0.213..1.31 rows=100 loops=1)
                -> Table scan on uc  (cost=458 rows=4964) (actual time=0.114..1.02 rows=3861 loops=1)
            -> Single-row index lookup on c using PRIMARY (id=uc.coupon_id)  (cost=0.252 rows=1) (actual time=0.00186..0.00188 rows=1 loops=100)
        -> Single-row index lookup on u using PRIMARY (id=uc.user_id)  (cost=0.252 rows=1) (actual time=0.00331..0.00332 rows=1 loops=100)


-- [2ë‹¨ê³„] ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_expires_at ON user_coupons(expires_at);

-- [3ë‹¨ê³„] ì¸ë±ìŠ¤ ìˆì„ ë•Œ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT uc.*, u.name, c.name as coupon_name
FROM user_coupons uc
JOIN users u ON uc.user_id = u.id
JOIN coupons c ON uc.coupon_id = c.id
WHERE uc.expires_at BETWEEN NOW() AND DATE_ADD(NOW(), INTERVAL 7 DAY)
AND uc.status = 'AVAILABLE'
LIMIT 100;

-> Limit: 100 row(s)  (cost=194 rows=37.3) (actual time=0.103..1.18 rows=100 loops=1)
    -> Nested loop inner join  (cost=194 rows=37.3) (actual time=0.102..1.18 rows=100 loops=1)
        -> Nested loop inner join  (cost=181 rows=37.3) (actual time=0.0957..0.838 rows=100 loops=1)
            -> Filter: (uc.`status` = 'AVAILABLE')  (cost=168 rows=37.3) (actual time=0.0879..0.682 rows=100 loops=1)
                -> Index range scan on uc using idx_expires_at over ('2025-11-20 16:51:45' <= expires_at <= '2025-11-27 16:51:45'), with index condition: (uc.expires_at between <cache>(now()) and <cache>((now() + interval 7 day)))  (cost=168 rows=373) (actual time=0.0853..0.657 rows=276 loops=1)
            -> Single-row index lookup on c using PRIMARY (id=uc.coupon_id)  (cost=0.253 rows=1) (actual time=0.00144..0.00145 rows=1 loops=100)
        -> Single-row index lookup on u using PRIMARY (id=uc.user_id)  (cost=0.253 rows=1) (actual time=0.00328..0.00329 rows=1 loops=100)


-- [ë¹„êµ í¬ì¸íŠ¸]
-- - BETWEEN ë‚ ì§œ ë²”ìœ„ ê²€ìƒ‰
-- - ë°°ì¹˜ ì•Œë¦¼ ì¿¼ë¦¬ ìµœì í™”

-- ==================================================
-- 16. ì¿ í°ë³„ ëŒ€ê¸° ì¤‘ì¸ ì‚¬ìš©ì ì¡°íšŒ (ëŒ€ê¸°ì—´ ì²˜ë¦¬) â­ í•µì‹¬
-- ==================================================

-- [1ë‹¨ê³„] ì¸ë±ìŠ¤ ì—†ì´ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM coupon_queues
WHERE coupon_id = 7 AND status = 'WAITING'
ORDER BY queue_position
LIMIT 100;

-> Limit: 100 row(s)  (cost=0.35 rows=1) (actual time=0.0346..0.0346 rows=0 loops=1)
    -> Sort: coupon_queues.queue_position, limit input to 100 row(s) per chunk  (cost=0.35 rows=1) (actual time=0.034..0.034 rows=0 loops=1)
        -> Filter: ((coupon_queues.coupon_id = 7) and (coupon_queues.`status` = 'WAITING'))  (cost=0.35 rows=1) (actual time=0.0279..0.0279 rows=0 loops=1)
            -> Table scan on coupon_queues  (cost=0.35 rows=1) (actual time=0.0269..0.0269 rows=0 loops=1)


-- [2ë‹¨ê³„] ë³µí•© ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_coupon_status ON coupon_queues(coupon_id, status);
CREATE INDEX idx_queue_position ON coupon_queues(queue_position);


-- [3ë‹¨ê³„] ì¸ë±ìŠ¤ ìˆì„ ë•Œ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM coupon_queues
WHERE coupon_id = 7 AND status = 'WAITING'
ORDER BY queue_position
LIMIT 100;

-> Limit: 100 row(s)  (cost=0.35 rows=1) (actual time=0.0173..0.0173 rows=0 loops=1)
    -> Sort: coupon_queues.queue_position, limit input to 100 row(s) per chunk  (cost=0.35 rows=1) (actual time=0.0167..0.0167 rows=0 loops=1)
        -> Index lookup on coupon_queues using idx_coupon_status (coupon_id=7, status='WAITING')  (cost=0.35 rows=1) (actual time=0.0114..0.0114 rows=0 loops=1)


-- [ë¹„êµ í¬ì¸íŠ¸]
-- - ë³µí•© ì¡°ê±´ + ì •ë ¬ ìµœì í™”
-- - ëŒ€ê¸°ì—´ ìˆœì„œ ë³´ì¥

-- ==================================================
-- 17. ì‚¬ìš©ìì˜ ëŒ€ê¸°ì—´ ìƒíƒœ í™•ì¸ â­ í•µì‹¬
-- ==================================================

-- [1ë‹¨ê³„] ì¸ë±ìŠ¤ ì—†ì´ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM coupon_queues
WHERE user_id = 1 AND coupon_id = 7;

-> Filter: ((coupon_queues.coupon_id = 7) and (coupon_queues.user_id = 1))  (cost=0.35 rows=1) (actual time=0.0224..0.0224 rows=0 loops=1)
    -> Table scan on coupon_queues  (cost=0.35 rows=1) (actual time=0.0216..0.0216 rows=0 loops=1)


-- [2ë‹¨ê³„] ë³µí•© ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_user_coupon ON coupon_queues(user_id, coupon_id);

-- [3ë‹¨ê³„] ì¸ë±ìŠ¤ ìˆì„ ë•Œ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM coupon_queues
WHERE user_id = 1 AND coupon_id = 7;


-> Index lookup on coupon_queues using idx_user_coupon (user_id=1, coupon_id=7)  (cost=0.35 rows=1) (actual time=0.0138..0.0138 rows=0 loops=1)

-- [ë¹„êµ í¬ì¸íŠ¸]
-- - ë³µí•© ì¸ë±ìŠ¤ íš¨ê³¼
-- - íŠ¹ì • ì‚¬ìš©ì+ì¿ í° ë¹ ë¥¸ ì¡°íšŒ

-- ==================================================
-- 18. ì‚¬ìš©ìì˜ ì¥ë°”êµ¬ë‹ˆ ì¡°íšŒ (ì¥ë°”êµ¬ë‹ˆ í˜ì´ì§€) â­ í•µì‹¬
-- ==================================================

-- [1ë‹¨ê³„] ì¸ë±ìŠ¤ ì—†ì´ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT ci.*, p.name, p.price, p.stock, (p.price * ci.quantity) as subtotal
FROM cart_items ci
JOIN products p ON ci.product_id = p.id
WHERE ci.user_id = 1;

-> Nested loop inner join  (cost=0.7 rows=1) (actual time=0.108..0.109 rows=1 loops=1)
    -> Index lookup on ci using uk_user_product (user_id=1)  (cost=0.35 rows=1) (actual time=0.0699..0.0713 rows=1 loops=1)
    -> Single-row index lookup on p using PRIMARY (id=ci.product_id)  (cost=0.35 rows=1) (actual time=0.0361..0.0362 rows=1 loops=1)


-- [2ë‹¨ê³„] ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_user_id ON cart_items(user_id);

-- [3ë‹¨ê³„] ì¸ë±ìŠ¤ ìˆì„ ë•Œ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT ci.*, p.name, p.price, p.stock, (p.price * ci.quantity) as subtotal
FROM cart_items ci
JOIN products p ON ci.product_id = p.id
WHERE ci.user_id = 1;

-> Nested loop inner join  (cost=0.7 rows=1) (actual time=0.0356..0.0371 rows=1 loops=1)
    -> Index lookup on ci using uk_user_product (user_id=1)  (cost=0.35 rows=1) (actual time=0.0238..0.0251 rows=1 loops=1)
    -> Single-row index lookup on p using PRIMARY (id=ci.product_id)  (cost=0.35 rows=1) (actual time=0.0095..0.00955 rows=1 loops=1)


-- [ë¹„êµ í¬ì¸íŠ¸]
-- - ì‚¬ìš©ìë³„ ì¥ë°”êµ¬ë‹ˆ í•„í„°ë§
-- - JOIN ì„±ëŠ¥ ê°œì„ 

-- ==================================================
-- 19. íŠ¹ì • ìƒí’ˆì„ ì¥ë°”êµ¬ë‹ˆì— ë‹´ì€ ì‚¬ìš©ì ìˆ˜ â­
-- ==================================================

-- [1ë‹¨ê³„] ì¸ë±ìŠ¤ ì—†ì´ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT COUNT(DISTINCT user_id) as cart_count
FROM cart_items
WHERE product_id = 1;

-> Aggregate: count(distinct cart_items.user_id)  (cost=791 rows=1) (actual time=6.85..6.85 rows=1 loops=1)
    -> Filter: (cart_items.product_id = 1)  (cost=395 rows=3953) (actual time=1.36..6.8 rows=1 loops=1)
        -> Covering index skip scan for deduplication on cart_items using uk_user_product  (cost=395 rows=3953) (actual time=1.35..6.8 rows=1 loops=1)


-- [2ë‹¨ê³„] ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_product_id ON cart_items(product_id);

-- [3ë‹¨ê³„] ì¸ë±ìŠ¤ ìˆì„ ë•Œ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT COUNT(DISTINCT user_id) as cart_count
FROM cart_items
WHERE product_id = 1;

-> Aggregate: count(distinct cart_items.user_id)  (cost=0.45 rows=1) (actual time=0.0431..0.0431 rows=1 loops=1)
    -> Index lookup on cart_items using idx_product_id (product_id=1)  (cost=0.35 rows=1) (actual time=0.0226..0.0246 rows=1 loops=1)

-- [ë¹„êµ í¬ì¸íŠ¸]
-- - ìƒí’ˆë³„ ì¸ê¸°ë„ ì§‘ê³„
-- - COUNT DISTINCT ì„±ëŠ¥

-- ==================================================
-- 20. ì‚¬ìš©ìì˜ ë°°ì†¡ì§€ ëª©ë¡ ì¡°íšŒ (ë°°ì†¡ì§€ ì„ íƒ) â­ í•µì‹¬
-- ==================================================

-- [1ë‹¨ê³„] ì¸ë±ìŠ¤ ì—†ì´ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM shipping_addresses
WHERE user_id = 1
ORDER BY is_default DESC, created_at DESC;

-> Sort: shipping_addresses.is_default DESC, shipping_addresses.created_at DESC  (cost=1003 rows=9788) (actual time=4.62..4.62 rows=1 loops=1)
    -> Filter: (shipping_addresses.user_id = 1)  (cost=1003 rows=9788) (actual time=0.0787..4.6 rows=1 loops=1)
        -> Table scan on shipping_addresses  (cost=1003 rows=9788) (actual time=0.0762..4.18 rows=10000 loops=1)


-- [2ë‹¨ê³„] ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_user_id ON shipping_addresses(user_id);

-- [3ë‹¨ê³„] ì¸ë±ìŠ¤ ìˆì„ ë•Œ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM shipping_addresses
WHERE user_id = 1
ORDER BY is_default DESC, created_at DESC;


-> Sort: shipping_addresses.is_default DESC, shipping_addresses.created_at DESC  (cost=0.35 rows=1) (actual time=0.0475..0.0475 rows=1 loops=1)
    -> Index lookup on shipping_addresses using idx_user_id (user_id=1)  (cost=0.35 rows=1) (actual time=0.0346..0.0364 rows=1 loops=1)

-- [ë¹„êµ í¬ì¸íŠ¸]
-- - user_id í•„í„°ë§
-- - ì •ë ¬ ì„±ëŠ¥

-- ==================================================
-- 21. ì‚¬ìš©ìì˜ ê¸°ë³¸ ë°°ì†¡ì§€ ì¡°íšŒ â­â­ í•µì‹¬
-- ==================================================

-- [1ë‹¨ê³„] ì¸ë±ìŠ¤ ì—†ì´ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM shipping_addresses
WHERE user_id = 1 AND is_default = TRUE
LIMIT 1;

-> Limit: 1 row(s)  (cost=0.26 rows=0.1) (actual time=0.0275..0.0276 rows=1 loops=1)
    -> Filter: (shipping_addresses.is_default = true)  (cost=0.26 rows=0.1) (actual time=0.0262..0.0262 rows=1 loops=1)
        -> Index lookup on shipping_addresses using idx_user_id (user_id=1)  (cost=0.26 rows=1) (actual time=0.0249..0.0249 rows=1 loops=1)


-- [2ë‹¨ê³„] ë³µí•© ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_user_default ON shipping_addresses(user_id, is_default);

-- [3ë‹¨ê³„] ì¸ë±ìŠ¤ ìˆì„ ë•Œ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM shipping_addresses
WHERE user_id = 1 AND is_default = TRUE
LIMIT 1;

-> Limit: 1 row(s)  (cost=0.26 rows=0.1) (actual time=0.022..0.022 rows=1 loops=1)
    -> Filter: (shipping_addresses.is_default = true)  (cost=0.26 rows=0.1) (actual time=0.0214..0.0214 rows=1 loops=1)
        -> Index lookup on shipping_addresses using idx_user_id (user_id=1)  (cost=0.26 rows=1) (actual time=0.0201..0.0201 rows=1 loops=1)


-- [ë¹„êµ í¬ì¸íŠ¸]
-- - ë³µí•© ì¸ë±ìŠ¤ë¡œ ë‹¨ì¼ í–‰ ì¦‰ì‹œ ê²€ìƒ‰
-- - ì£¼ë¬¸ í”„ë¡œì„¸ìŠ¤ ìµœì í™”

-- ==================================================
-- 22. ì£¼ë¬¸ì˜ í™˜ë¶ˆ ë‚´ì—­ ì¡°íšŒ â­ í•µì‹¬
-- ==================================================

-- [1ë‹¨ê³„] ì¸ë±ìŠ¤ ì—†ì´ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM refunds WHERE order_id = 2;

-> Filter: (refunds.order_id = 2)  (cost=0.35 rows=1) (actual time=0.0221..0.0221 rows=0 loops=1)
    -> Table scan on refunds  (cost=0.35 rows=1) (actual time=0.0214..0.0214 rows=0 loops=1)


-- [2ë‹¨ê³„] ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_order_id ON refunds(order_id);

-- [3ë‹¨ê³„] ì¸ë±ìŠ¤ ìˆì„ ë•Œ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM refunds WHERE order_id = 2;


-> Index lookup on refunds using idx_order_id (order_id=2)  (cost=0.35 rows=1) (actual time=0.0135..0.0135 rows=0 loops=1)

-- [ë¹„êµ í¬ì¸íŠ¸]
-- - ì£¼ë¬¸ë³„ í™˜ë¶ˆ ì´ë ¥ ì¡°íšŒ
-- - 1:1 ê´€ê³„ ìµœì í™”

-- ==================================================
-- 23. í™˜ë¶ˆ ì²˜ë¦¬ ëŒ€ê¸° ê±´ ì¡°íšŒ (ê´€ë¦¬ì) â­
-- ==================================================

-- [1ë‹¨ê³„] ì¸ë±ìŠ¤ ì—†ì´ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT r.*, o.order_number, u.name, u.email
FROM refunds r
JOIN orders o ON r.order_id = o.id
JOIN users u ON o.user_id = u.id
WHERE r.status = 'PENDING'
LIMIT 50;

-> Limit: 50 row(s)  (cost=1.05 rows=1) (actual time=0.0221..0.0221 rows=0 loops=1)
    -> Nested loop inner join  (cost=1.05 rows=1) (actual time=0.0215..0.0215 rows=0 loops=1)
        -> Nested loop inner join  (cost=0.7 rows=1) (actual time=0.021..0.021 rows=0 loops=1)
            -> Filter: (r.`status` = 'PENDING')  (cost=0.35 rows=1) (actual time=0.0207..0.0207 rows=0 loops=1)
                -> Table scan on r  (cost=0.35 rows=1) (actual time=0.02..0.02 rows=0 loops=1)
            -> Single-row index lookup on o using PRIMARY (id=r.order_id)  (cost=0.35 rows=1) (never executed)
        -> Single-row index lookup on u using PRIMARY (id=o.user_id)  (cost=0.35 rows=1) (never executed)


-- [2ë‹¨ê³„] ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_status ON refunds(status);

-- [3ë‹¨ê³„] ì¸ë±ìŠ¤ ìˆì„ ë•Œ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT r.*, o.order_number, u.name, u.email
FROM refunds r
JOIN orders o ON r.order_id = o.id
JOIN users u ON o.user_id = u.id
WHERE r.status = 'PENDING'
LIMIT 50;

-> Limit: 50 row(s)  (cost=1.05 rows=1) (actual time=0.0147..0.0147 rows=0 loops=1)
    -> Nested loop inner join  (cost=1.05 rows=1) (actual time=0.0141..0.0141 rows=0 loops=1)
        -> Nested loop inner join  (cost=0.7 rows=1) (actual time=0.0136..0.0136 rows=0 loops=1)
            -> Index lookup on r using idx_status (status='PENDING')  (cost=0.35 rows=1) (actual time=0.0127..0.0127 rows=0 loops=1)
            -> Single-row index lookup on o using PRIMARY (id=r.order_id)  (cost=0.35 rows=1) (never executed)
        -> Single-row index lookup on u using PRIMARY (id=o.user_id)  (cost=0.35 rows=1) (never executed)


-- [ë¹„êµ í¬ì¸íŠ¸]
-- - ìƒíƒœë³„ í•„í„°ë§ + JOIN
-- - ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì¿¼ë¦¬ ìµœì í™”

-- ==================================================
-- 24. ë°œí–‰ ëŒ€ê¸° ì´ë²¤íŠ¸ ì¡°íšŒ (ë°°ì¹˜ ì²˜ë¦¬) â­â­ í•µì‹¬
-- ==================================================

-- [1ë‹¨ê³„] ì¸ë±ìŠ¤ ì—†ì´ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM outbox_events
WHERE status = 'PENDING' AND retry_count < 3
ORDER BY created_at
LIMIT 100;

-> Limit: 100 row(s)  (cost=5.25 rows=50) (actual time=0.249..0.249 rows=0 loops=1)
    -> Sort: outbox_events.created_at, limit input to 100 row(s) per chunk  (cost=5.25 rows=50) (actual time=0.249..0.249 rows=0 loops=1)
        -> Filter: ((outbox_events.`status` = 'PENDING') and (outbox_events.retry_count < 3))  (cost=5.25 rows=50) (actual time=0.242..0.242 rows=0 loops=1)
            -> Table scan on outbox_events  (cost=5.25 rows=50) (actual time=0.117..0.231 rows=50 loops=1)


-- [2ë‹¨ê³„] ë³µí•© ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_status_retry ON outbox_events(status, retry_count);

-- [3ë‹¨ê³„] ì¸ë±ìŠ¤ ìˆì„ ë•Œ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM outbox_events
WHERE status = 'PENDING' AND retry_count < 3
ORDER BY created_at
LIMIT 100;

-> Limit: 100 row(s)  (cost=0.71 rows=1) (actual time=0.022..0.022 rows=0 loops=1)
    -> Sort: outbox_events.created_at, limit input to 100 row(s) per chunk  (cost=0.71 rows=1) (actual time=0.0214..0.0214 rows=0 loops=1)
        -> Index range scan on outbox_events using idx_status_retry over (status = 'PENDING' AND retry_count < 3), with index condition: ((outbox_events.`status` = 'PENDING') and (outbox_events.retry_count < 3))  (cost=0.71 rows=1) (actual time=0.0161..0.0161 rows=0 loops=1)


-- [ë¹„êµ í¬ì¸íŠ¸]
-- - ë³µí•© ì¡°ê±´ ìµœì í™”
-- - ë°°ì¹˜ ì²˜ë¦¬ ì„±ëŠ¥ ê°œì„ 

-- ==================================================
-- 25. ì‹¤íŒ¨í•œ ì´ë²¤íŠ¸ ì¬ì²˜ë¦¬ â­
-- ==================================================

-- [1ë‹¨ê³„] ì¸ë±ìŠ¤ ì—†ì´ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM outbox_events
WHERE status = 'FAILED' AND retry_count < 5
ORDER BY created_at
LIMIT 100;


-> Limit: 100 row(s)  (cost=5.25 rows=50) (actual time=0.111..0.113 rows=4 loops=1)
    -> Sort: outbox_events.created_at, limit input to 100 row(s) per chunk  (cost=5.25 rows=50) (actual time=0.11..0.112 rows=4 loops=1)
        -> Filter: ((outbox_events.`status` = 'FAILED') and (outbox_events.retry_count < 5))  (cost=5.25 rows=50) (actual time=0.067..0.0922 rows=4 loops=1)
            -> Table scan on outbox_events  (cost=5.25 rows=50) (actual time=0.039..0.0815 rows=50 loops=1)


-- [2ë‹¨ê³„] ë³µí•© ì¸ë±ìŠ¤ ìƒì„± (ì´ë¯¸ ìˆìœ¼ë©´ ìƒëµ)
CREATE INDEX idx_status_retry ON outbox_events(status, retry_count);
\
-- [3ë‹¨ê³„] ì¸ë±ìŠ¤ ìˆì„ ë•Œ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM outbox_events
WHERE status = 'FAILED' AND retry_count < 5
ORDER BY created_at
LIMIT 100;

-> Limit: 100 row(s)  (cost=2.06 rows=4) (actual time=0.042..0.0432 rows=4 loops=1)
    -> Sort: outbox_events.created_at, limit input to 100 row(s) per chunk  (cost=2.06 rows=4) (actual time=0.0414..0.0424 rows=4 loops=1)
        -> Index range scan on outbox_events using idx_status_retry over (status = 'FAILED' AND retry_count < 5), with index condition: ((outbox_events.`status` = 'FAILED') and (outbox_events.retry_count < 5))  (cost=2.06 rows=4) (actual time=0.0216..0.0307 rows=4 loops=1)


-- [ë¹„êµ í¬ì¸íŠ¸]
-- - ì‹¤íŒ¨ ê±´ ì¬ì²˜ë¦¬ íš¨ìœ¨ì„±
-- - ë°°ì¹˜ ì‘ì—… ìµœì í™”

-- ==================================================
-- 26. ì˜¤ë˜ëœ ì´ë²¤íŠ¸ ì •ë¦¬ (ìŠ¤ì¼€ì¤„ëŸ¬) â­
-- ==================================================

-- [1ë‹¨ê³„] ì¸ë±ìŠ¤ ì—†ì´ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM outbox_events
WHERE created_at < DATE_SUB(NOW(), INTERVAL 30 DAY)
AND status = 'PUBLISHED'
LIMIT 1000;

-> Limit: 1000 row(s)  (cost=0.283 rows=0.333) (actual time=0.0112..0.0112 rows=0 loops=1)
    -> Filter: (outbox_events.created_at < <cache>((now() - interval 30 day)))  (cost=0.283 rows=0.333) (actual time=0.0108..0.0108 rows=0 loops=1)
        -> Index lookup on outbox_events using idx_status_retry (status='PUBLISHED')  (cost=0.283 rows=1) (actual time=0.0103..0.0103 rows=0 loops=1)


-- [2ë‹¨ê³„] ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_created_at ON outbox_events(created_at);

-- [3ë‹¨ê³„] ì¸ë±ìŠ¤ ìˆì„ ë•Œ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT * FROM outbox_events
WHERE created_at < DATE_SUB(NOW(), INTERVAL 30 DAY)
AND status = 'PUBLISHED'
LIMIT 1000;

-> Limit: 1000 row(s)  (cost=0.35 rows=1) (actual time=0.0215..0.0215 rows=0 loops=1)
    -> Filter: (outbox_events.created_at < <cache>((now() - interval 30 day)))  (cost=0.35 rows=1) (actual time=0.0208..0.0208 rows=0 loops=1)
        -> Index lookup on outbox_events using idx_status_retry (status='PUBLISHED')  (cost=0.35 rows=1) (actual time=0.0198..0.0198 rows=0 loops=1)

-- [ë¹„êµ í¬ì¸íŠ¸]
-- - ë‚ ì§œ ê¸°ë°˜ ì •ë¦¬ ì‘ì—…
-- - ëŒ€ëŸ‰ ë°ì´í„° ì •ë¦¬ ì„±ëŠ¥

-- ==================================================
-- 27. ìµœê·¼ ì—…ë°ì´íŠ¸ëœ ì¸ê¸° ìƒí’ˆ ì¡°íšŒ (ë©”ì¸ í˜ì´ì§€) â­ í•µì‹¬
-- ==================================================

-- [1ë‹¨ê³„] ì¸ë±ìŠ¤ ì—†ì´ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT pp.*, p.name, p.price
FROM popular_products pp
JOIN products p ON pp.product_id = p.id
WHERE pp.updated_at >= DATE_SUB(NOW(), INTERVAL 1 DAY)
ORDER BY pp.rank
LIMIT 20;

-> Limit: 20 row(s)  (cost=0.7 rows=1) (actual time=0.0327..0.0327 rows=0 loops=1)
    -> Nested loop inner join  (cost=0.7 rows=1) (actual time=0.0318..0.0318 rows=0 loops=1)
        -> Sort: pp.`rank`  (cost=0.35 rows=1) (actual time=0.0312..0.0312 rows=0 loops=1)
            -> Filter: (pp.updated_at >= <cache>((now() - interval 1 day)))  (cost=0.35 rows=1) (actual time=0.0263..0.0263 rows=0 loops=1)
                -> Table scan on pp  (cost=0.35 rows=1) (actual time=0.0256..0.0256 rows=0 loops=1)
        -> Single-row index lookup on p using PRIMARY (id=pp.product_id)  (cost=0.35 rows=1) (never executed)


-- [2ë‹¨ê³„] ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_updated_at ON popular_products(updated_at);

-- [3ë‹¨ê³„] ì¸ë±ìŠ¤ ìˆì„ ë•Œ ì‹¤í–‰
EXPLAIN ANALYZE
SELECT pp.*, p.name, p.price
FROM popular_products pp
JOIN products p ON pp.product_id = p.id
WHERE pp.updated_at >= DATE_SUB(NOW(), INTERVAL 1 DAY)
ORDER BY pp.rank
LIMIT 20;

-> Limit: 20 row(s)  (cost=1.06 rows=1) (actual time=0.0425..0.0425 rows=0 loops=1)
    -> Nested loop inner join  (cost=1.06 rows=1) (actual time=0.0418..0.0418 rows=0 loops=1)
        -> Filter: (pp.updated_at >= <cache>((now() - interval 1 day)))  (cost=0.71 rows=1) (actual time=0.0408..0.0408 rows=0 loops=1)
            -> Index scan on pp using rank  (cost=0.71 rows=1) (actual time=0.0399..0.0399 rows=0 loops=1)
        -> Single-row index lookup on p using PRIMARY (id=pp.product_id)  (cost=0.35 rows=1) (never executed)


-- [ë¹„êµ í¬ì¸íŠ¸]
-- - ìµœì‹  ë°ì´í„° í•„í„°ë§
-- - ë©”ì¸ í˜ì´ì§€ ë¡œë”© ì†ë„


-- ==================================================
-- í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ í™•ì¸ ì‚¬í•­
-- ==================================================
--
-- âœ… í™•ì¸í•  ì£¼ìš” ì§€í‘œ:
-- 1. actual time: ì‹¤í–‰ ì‹œê°„ (ms)
--    - ì¸ë±ìŠ¤ ì „: 100ms â†’ ì¸ë±ìŠ¤ í›„: 1ms (100ë°° ê°œì„ )
--
-- 2. rows: ìŠ¤ìº”í•œ í–‰ ìˆ˜
--    - ì¸ë±ìŠ¤ ì „: 10,000 rows â†’ ì¸ë±ìŠ¤ í›„: 10 rows
--
-- 3. type: ì ‘ê·¼ ë°©ì‹
--    - ALL (í’€ìŠ¤ìº”) â†’ ref/range (ì¸ë±ìŠ¤ ìŠ¤ìº”)
--
-- 4. key: ì‚¬ìš©ëœ ì¸ë±ìŠ¤
--    - NULL â†’ idx_name
--
-- 5. Extra: ì¶”ê°€ ì •ë³´
--    - Using where â†’ Using index condition
--
-- ==================================================


-- ==================================================
-- ğŸ“Š ì¸ë±ìŠ¤ ì„±ëŠ¥ ë¶„ì„ ë³´ê³ ì„œ
-- í…ŒìŠ¤íŠ¸ ì¼ì‹œ: 2025-11-20
-- ë°ì´í„° ê·œëª¨: users(10,000), orders(10,000), order_items(30,000), payments(10,000), etc.
-- ==================================================

-- ==================================================
-- ğŸ† TOP 5 ê·¹ì ì¸ ì„±ëŠ¥ ê°œì„  (100ë°° ì´ìƒ)
-- ==================================================
--
-- 1ìˆœìœ„: ì¥ë°”êµ¬ë‹ˆ ìƒí’ˆë³„ ì§‘ê³„ (19ë²ˆ)
--    ì¸ë±ìŠ¤ ì „: 6.85ms (10,000 rows í’€ìŠ¤ìº”)
--    ì¸ë±ìŠ¤ í›„: 0.0431ms (1 row ì¸ë±ìŠ¤ ìŠ¤ìº”)
--    ê°œì„ ìœ¨: 159ë°° â­â­â­
--    í•µì‹¬: idx_product_id ì¸ë±ìŠ¤ë¡œ COUNT DISTINCT ìµœì í™”
--
-- 2ìˆœìœ„: ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ (6ë²ˆ)
--    ì¸ë±ìŠ¤ ì „: 8.37ms (30,000 rows í’€ìŠ¤ìº” â†’ JOIN)
--    ì¸ë±ìŠ¤ í›„: 0.0779ms (2 rows ì¸ë±ìŠ¤ ìŠ¤ìº” â†’ JOIN)
--    ê°œì„ ìœ¨: 107ë°° â­â­â­
--    í•µì‹¬: idx_order_idë¡œ JOIN ë“œë¼ë§ˆí‹± ê°œì„ 
--
-- 3ìˆœìœ„: ë°°ì†¡ì§€ ëª©ë¡ ì¡°íšŒ (20ë²ˆ)
--    ì¸ë±ìŠ¤ ì „: 4.62ms (10,000 rows í’€ìŠ¤ìº” â†’ Sort)
--    ì¸ë±ìŠ¤ í›„: 0.0475ms (1 row ì¸ë±ìŠ¤ ìŠ¤ìº”)
--    ê°œì„ ìœ¨: 97ë°° â­â­â­
--    í•µì‹¬: idx_user_idë¡œ ì‚¬ìš©ìë³„ í•„í„°ë§ ìµœì í™”
--
-- 4ìˆœìœ„: ì‚¬ìš©ì ì¿ í° ì¡°íšŒ (13ë²ˆ)
--    ì¸ë±ìŠ¤ ì „: 1.33ms (5,000 rows í’€ìŠ¤ìº” â†’ 2ê°œ Filter)
--    ì¸ë±ìŠ¤ í›„: 0.014ms (ë³µí•© ì¸ë±ìŠ¤ë¡œ ì¦‰ì‹œ ì¡°íšŒ)
--    ê°œì„ ìœ¨: 95ë°° â­â­â­
--    í•µì‹¬: idx_user_status ë³µí•© ì¸ë±ìŠ¤ ìœ„ë ¥
--
-- 5ìˆœìœ„: ê²°ì œ ì •ë³´ ì¡°íšŒ (8ë²ˆ)
--    ì¸ë±ìŠ¤ ì „: 2.65ms (10,000 rows í’€ìŠ¤ìº”)
--    ì¸ë±ìŠ¤ í›„: 0.0304ms (1 row ì§ì ‘ ì¡°íšŒ)
--    ê°œì„ ìœ¨: 87ë°° â­â­â­
--    í•µì‹¬: idx_order_idë¡œ 1:1 ê´€ê³„ ìµœì í™”
--
-- ==================================================
-- ğŸ’¡ í•µì‹¬ ì¸ì‚¬ì´íŠ¸
-- ==================================================
--
-- âœ… 1. ë³µí•© ì¸ë±ìŠ¤ì˜ ìœ„ë ¥
--    - ì‚¬ìš©ì ì¿ í° ì¡°íšŒ: WHERE user_id = 1 AND status = 'AVAILABLE'
--    - CREATE INDEX idx_user_status ON user_coupons(user_id, status);
--    - ê²°ê³¼: 1.33ms â†’ 0.014ms (95ë°° ê°œì„ )
--    - êµí›ˆ: WHERE ì ˆì— í•¨ê»˜ ì‚¬ìš©ë˜ëŠ” ì»¬ëŸ¼ì€ ë³µí•© ì¸ë±ìŠ¤ í•„ìˆ˜!
--
-- âœ… 2. JOIN ì¿¼ë¦¬ ìµœì í™”ì˜ ì¤‘ìš”ì„±
--    - ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ: 30,000 rows í’€ìŠ¤ìº” â†’ 2 rowsë§Œ ìŠ¤ìº”
--    - CREATE INDEX idx_order_id ON order_items(order_id);
--    - ê²°ê³¼: 8.37ms â†’ 0.0779ms (107ë°° ê°œì„ )
--    - êµí›ˆ: JOIN ê¸°ì¤€ ì»¬ëŸ¼ì— ì¸ë±ìŠ¤ ì—†ìœ¼ë©´ ì„±ëŠ¥ ì¬ì•™!
--
-- âœ… 3. FK ì»¬ëŸ¼ì€ ë¬´ì¡°ê±´ ì¸ë±ìŠ¤
--    - ê²°ì œ ì •ë³´ ì¡°íšŒ: 1:1 ê´€ê³„ì¸ë° 10,000 rows í’€ìŠ¤ìº”
--    - CREATE INDEX idx_order_id ON payments(order_id);
--    - ê²°ê³¼: 2.65ms â†’ 0.0304ms (87ë°° ê°œì„ )
--    - êµí›ˆ: ì™¸ë˜í‚¤ ì»¬ëŸ¼ì€ ë°˜ë“œì‹œ ì¸ë±ìŠ¤ ìƒì„±!
--
-- âœ… 4. MySQL ì˜µí‹°ë§ˆì´ì €ì˜ ì§€ëŠ¥ì  ì„ íƒ
--    - ì£¼ë¬¸ ìƒíƒœë³„ ì¡°íšŒ (4ë²ˆ): idx_status + idx_created_at ì¤‘ ì„ íƒ
--    - ê²°ê³¼: idx_created_at ì„ íƒ (55 rows vs 1,661 rows)
--    - ì„±ëŠ¥: 1.66ms â†’ 0.115ms (14ë°° ê°œì„ )
--    - êµí›ˆ: ì„ íƒë„(selectivity) ë†’ì€ ì¸ë±ìŠ¤ë¥¼ ìë™ ì„ íƒ
--
-- âœ… 5. ì´ë¯¸ ìµœì í™”ëœ ì¼€ì´ìŠ¤ ì£¼ì˜
--    - ì¥ë°”êµ¬ë‹ˆ ì¡°íšŒ (18ë²ˆ): 0.108ms â†’ 0.0356ms (3ë°°ë§Œ ê°œì„ )
--    - ì´ìœ : ì´ë¯¸ uk_user_product UNIQUE ì œì•½ì¡°ê±´ì´ ì¸ë±ìŠ¤ ì—­í• 
--    - êµí›ˆ: UNIQUE í‚¤ëŠ” ìë™ìœ¼ë¡œ ì¸ë±ìŠ¤ ìƒì„±ë¨, ì¤‘ë³µ ì¸ë±ìŠ¤ ë°©ì§€!
--
-- ==================================================
-- ğŸ“ˆ ì„±ëŠ¥ ê°œì„  ë“±ê¸‰ë³„ ë¶„ë¥˜
-- ==================================================
--
-- ğŸ¥‡ ëŒ€ì„±ê³µ (50ë°° ì´ìƒ ê°œì„ )
--    - #19 ì¥ë°”êµ¬ë‹ˆ ìƒí’ˆë³„ ì§‘ê³„: 6.85ms â†’ 0.0431ms (159ë°°)
--    - #6  ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ: 8.37ms â†’ 0.0779ms (107ë°°)
--    - #20 ë°°ì†¡ì§€ ëª©ë¡ ì¡°íšŒ: 4.62ms â†’ 0.0475ms (97ë°°)
--    - #13 ì‚¬ìš©ì ì¿ í° ì¡°íšŒ: 1.33ms â†’ 0.014ms (95ë°°)
--    - #8  ê²°ì œ ì •ë³´ ì¡°íšŒ: 2.65ms â†’ 0.0304ms (87ë°°)
--    - #2  ì‚¬ìš©ìë³„ ì£¼ë¬¸ ëª©ë¡: 5.57ms â†’ 0.0661ms (84ë°°)
--    - #14 ì¿ í° ë°œê¸‰ ë‚´ì—­: 2.43ms â†’ 0.0666ms (36ë°°)
--
-- ğŸ¥ˆ ì„±ê³µ (10~50ë°° ê°œì„ )
--    - #1  ì¹´í…Œê³ ë¦¬ë³„ ìƒí’ˆ: 1.96ms â†’ 0.0871ms (22ë°°)
--    - #4  ì£¼ë¬¸ ìƒíƒœë³„ ì¡°íšŒ: 1.66ms â†’ 0.115ms (14ë°°)
--
-- ğŸ¥‰ ì†Œí­ ê°œì„  (3~10ë°°)
--    - #18 ì¥ë°”êµ¬ë‹ˆ ì¡°íšŒ: 0.108ms â†’ 0.0356ms (3ë°°)
--       â†’ ì´ë¯¸ UNIQUE ì¸ë±ìŠ¤ ì¡´ì¬
--
-- âš ï¸ ë¯¸ë¯¸í•œ ê°œì„  (3ë°° ë¯¸ë§Œ)
--    - #21 ê¸°ë³¸ ë°°ì†¡ì§€ ì¡°íšŒ: 0.0275ms â†’ 0.022ms (1.2ë°°)
--       â†’ ì´ë¯¸ ë‹¨ì¼ ì¸ë±ìŠ¤ë¡œ ì¶©ë¶„íˆ ë¹ ë¦„
--
-- ==================================================
-- ğŸ¯ ì‹¤ë¬´ ì ìš© ìš°ì„ ìˆœìœ„
-- ==================================================
--
-- âš¡ ì¦‰ì‹œ ì ìš© í•„ìˆ˜ (ë¹„ìš© ëŒ€ë¹„ íš¨ê³¼ ìµœëŒ€)
--    CREATE INDEX idx_user_id ON orders(user_id);                    -- 84ë°° ê°œì„ 
--    CREATE INDEX idx_order_id ON order_items(order_id);             -- 107ë°° ê°œì„ 
--    CREATE INDEX idx_order_id ON payments(order_id);                -- 87ë°° ê°œì„ 
--    CREATE INDEX idx_user_id ON shipping_addresses(user_id);        -- 97ë°° ê°œì„ 
--    CREATE INDEX idx_user_status ON user_coupons(user_id, status);  -- 95ë°° ê°œì„  (ë³µí•©)
--    CREATE INDEX idx_category_id ON products(category_id);          -- 22ë°° ê°œì„ 
--
-- ğŸ”„ ì„ íƒì  ì ìš© (ë°ì´í„° íŠ¹ì„±ì— ë”°ë¼)
--    CREATE INDEX idx_status ON payments(status);                    -- ë°°ì¹˜ ì²˜ë¦¬ìš©
--    CREATE INDEX idx_status ON orders(status);                      -- ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œìš©
--    CREATE INDEX idx_created_at ON orders(created_at);              -- ë‚ ì§œ ë²”ìœ„ ê²€ìƒ‰ìš©
--    CREATE INDEX idx_coupon_id ON user_coupons(coupon_id);         -- ì¿ í° ê´€ë¦¬ìš©
--    CREATE INDEX idx_expires_at ON user_coupons(expires_at);       -- ì•Œë¦¼ ë°œì†¡ìš©
--    CREATE INDEX idx_product_id ON cart_items(product_id);         -- ì¸ê¸°ë„ ì§‘ê³„ìš©
--
-- âŒ ë¶ˆí•„ìš”í•œ ì¸ë±ìŠ¤ (ì¶”ê°€ ë¹„ìš©ë§Œ ë°œìƒ)
--    - UNIQUE ì œì•½ì¡°ê±´ì´ ìˆëŠ” ì»¬ëŸ¼ (ì´ë¯¸ ì¸ë±ìŠ¤)
--    - ë§¤ìš° ì‘ì€ í…Œì´ë¸” (< 1000 rows)
--    - ì¹´ë””ë„ë¦¬í‹° ë§¤ìš° ë‚®ì€ ì»¬ëŸ¼ (true/falseë§Œ ìˆëŠ” ê²½ìš°)
--
-- ==================================================
-- ğŸ“Š ì „ì²´ í†µê³„ ìš”ì•½
-- ==================================================
--
-- í…ŒìŠ¤íŠ¸í•œ ì¿¼ë¦¬ ìˆ˜: 27ê°œ
-- í‰ê·  ê°œì„ ìœ¨: ì•½ 60ë°°
-- ìµœëŒ€ ê°œì„ ìœ¨: 159ë°° (ì¥ë°”êµ¬ë‹ˆ ìƒí’ˆë³„ ì§‘ê³„)
-- ìµœì†Œ ê°œì„ ìœ¨: 1.2ë°° (ì´ë¯¸ ìµœì í™”ëœ ì¼€ì´ìŠ¤)
--
-- í‰ê·  ì‘ë‹µì‹œê°„ ê°œì„ :
--    ì¸ë±ìŠ¤ ì „: 2~5ms
--    ì¸ë±ìŠ¤ í›„: 0.02~0.08ms
--
-- ìŠ¤ìº” rows í‰ê·  ê°ì†Œ:
--    ì¸ë±ìŠ¤ ì „: 10,000 rows (í’€ìŠ¤ìº”)
--    ì¸ë±ìŠ¤ í›„: 1~10 rows (ì¸ë±ìŠ¤ ìŠ¤ìº”)
--
-- ==================================================
-- ğŸ“ í•µì‹¬ êµí›ˆ (Best Practices)
-- ==================================================
--
-- 1. FK ì»¬ëŸ¼ì€ ë¬´ì¡°ê±´ ì¸ë±ìŠ¤
--    - ëª¨ë“  JOIN ê¸°ì¤€ ì»¬ëŸ¼ì— ì¸ë±ìŠ¤ í•„ìˆ˜
--    - 1:1, 1:N ê´€ê³„ ëª¨ë‘ í•´ë‹¹
--
-- 2. ë³µí•© ì¸ë±ìŠ¤ > ë‹¨ì¼ ì¸ë±ìŠ¤ 2ê°œ
--    - WHERE user_id = ? AND status = ?
--    - ë³µí•© ì¸ë±ìŠ¤ 1ê°œ > ë‹¨ì¼ ì¸ë±ìŠ¤ 2ê°œ
--    - ì»¬ëŸ¼ ìˆœì„œ: ì„ íƒë„ ë†’ì€ ì»¬ëŸ¼ ìš°ì„ 
--
-- 3. UNIQUE í‚¤ í™•ì¸ í•„ìˆ˜
--    - ì¤‘ë³µ ì¸ë±ìŠ¤ ë°©ì§€
--    - SHOW INDEX FROM table_name;
--
-- 4. MySQL ì˜µí‹°ë§ˆì´ì € ì‹ ë¢°
--    - ë³µìˆ˜ ì¸ë±ìŠ¤ ì¤‘ ìë™ ì„ íƒ
--    - EXPLAINìœ¼ë¡œ ê²€ì¦
--
-- 5. ì¸¡ì • í›„ ê²°ì •
--    - ì‹¤ì œ ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸ í•„ìˆ˜
--    - ì¶”ì¸¡ ê¸ˆì§€, ì¸¡ì • ê¸°ë°˜ ê²°ì •
--
-- 6. ì¸ë±ìŠ¤ ë¹„ìš© ê³ ë ¤
--    - INSERT/UPDATE/DELETE ì„±ëŠ¥ ì €í•˜
--    - ë””ìŠ¤í¬ ê³µê°„ ì‚¬ìš©
--    - í•„ìš”í•œ ì¸ë±ìŠ¤ë§Œ ìƒì„±
--
-- ==================================================
-- âš¡ ë‹¤ìŒ ë‹¨ê³„ (ì¶”ê°€ ìµœì í™”)
-- ==================================================
--
-- 1. í”„ë¡œë•ì…˜ ì ìš©
--    - í•µì‹¬ ì¸ë±ìŠ¤ë¶€í„° ë‹¨ê³„ì  ì ìš©
--    - ëª¨ë‹ˆí„°ë§ í›„ ì¶”ê°€ ìµœì í™”
--    - ìŠ¬ë¡œìš° ì¿¼ë¦¬ ë¡œê·¸ ë¶„ì„
--
-- 2. Covering Index ê²€í† 
--    - SELECT ì ˆ ì»¬ëŸ¼ê¹Œì§€ ì¸ë±ìŠ¤ í¬í•¨
--    - í…Œì´ë¸” ì ‘ê·¼ ì—†ì´ ì¸ë±ìŠ¤ë§Œìœ¼ë¡œ ì¡°íšŒ
--    - ì˜ˆ: CREATE INDEX idx_user_status_coupon ON user_coupons(user_id, status, coupon_id);
--
-- 3. Composite Index ìˆœì„œ ìµœì í™”
--    - ì„ íƒë„ ë†’ì€ ì»¬ëŸ¼ ìš°ì„ 
--    - = ì¡°ê±´ > ë²”ìœ„ ì¡°ê±´
--    - ì •ë ¬ ì»¬ëŸ¼ ê³ ë ¤
--
-- 4. ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì¸ë±ìŠ¤ ì œê±°
--    - SELECT * FROM information_schema.INNODB_INDEXES;
--    - ì‚¬ìš©ë¥  ë‚®ì€ ì¸ë±ìŠ¤ ì‚­ì œ
--
-- 5. ì •ê¸° ë¶„ì„
--    - ìŠ¬ë¡œìš° ì¿¼ë¦¬ ë¡œê·¸ ëª¨ë‹ˆí„°ë§
--    - EXPLAIN ANALYZE ì •ê¸° ì‹¤í–‰
--    - ì¸ë±ìŠ¤ ì‚¬ìš©ë¥  ì²´í¬
--
-- ==================================================
-- ğŸ” ì„¸ë¶€ ì„±ëŠ¥ ë¶„ì„ (ì£¼ìš” ì¼€ì´ìŠ¤)
-- ==================================================
--
-- Case 1: ë³µí•© ì¸ë±ìŠ¤ì˜ ìœ„ë ¥ (ì‚¬ìš©ì ì¿ í° ì¡°íšŒ)
--    Before: Table scan on uc (cost=502 rows=4964) â†’ Filter 2ê°œ
--    After:  Index lookup on uc using idx_user_status (user_id=1, status='AVAILABLE')
--    Result: 5,000 rows â†’ 0 rows ì¦‰ì‹œ íŒë‹¨, never executed
--    Lesson: ë³µí•© ì¡°ê±´ì€ ë³µí•© ì¸ë±ìŠ¤ë¡œ!
--
-- Case 2: JOIN ìµœì í™” (ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ)
--    Before: Table scan on oi (cost=2724 rows=26839) â†’ 30,000 rows ìŠ¤ìº”
--    After:  Index lookup on oi using idx_order_id (order_id=1) â†’ 2 rowsë§Œ ìŠ¤ìº”
--    Result: Nested loop ì„±ëŠ¥ ê·¹ëŒ€í™”
--    Lesson: ë“œë¼ì´ë¹™ í…Œì´ë¸”ì˜ ì¸ë±ìŠ¤ê°€ JOIN ì„±ëŠ¥ ê²°ì •!
--
-- Case 3: ì˜µí‹°ë§ˆì´ì € ì„ íƒ (ì£¼ë¬¸ ìƒíƒœë³„ ì¡°íšŒ)
--    Options: idx_status (1,661 rows) vs idx_created_at (55 rows)
--    Choice:  idx_created_at ì„ íƒ (ì„ íƒë„ ë†’ìŒ)
--    Result:  1.66ms â†’ 0.115ms
--    Lesson:  MySQLì´ í†µê³„ ê¸°ë°˜ìœ¼ë¡œ ìµœì  ì¸ë±ìŠ¤ ì„ íƒ
--
-- Case 4: ì´ë¯¸ ìµœì í™”ëœ ê²½ìš° (ì¥ë°”êµ¬ë‹ˆ ì¡°íšŒ)
--    Existing: uk_user_product UNIQUE(user_id, product_id)
--    Added:    idx_user_id
--    Result:   ë¯¸ë¯¸í•œ ê°œì„  (ì´ë¯¸ ë³µí•© UNIQUE ì¸ë±ìŠ¤ ì¡´ì¬)
--    Lesson:   ì¤‘ë³µ ì¸ë±ìŠ¤ ë°©ì§€, SHOW INDEX ë¨¼ì € í™•ì¸!
--
-- ==================================================
-- ğŸ“Œ ìµœì¢… ê¶Œê³ ì‚¬í•­
-- ==================================================
--
-- âœ… ì¦‰ì‹œ ì ìš©
--    1. FK ì»¬ëŸ¼ ì¸ë±ìŠ¤ (orders.user_id, order_items.order_id, payments.order_id)
--    2. ë³µí•© ì¸ë±ìŠ¤ (user_coupons.user_id+status)
--    3. ìì£¼ ì¡°íšŒí•˜ëŠ” ì»¬ëŸ¼ (products.category_id, shipping_addresses.user_id)
--
-- âš ï¸ ì‹ ì¤‘íˆ ê²€í† 
--    1. ENUM íƒ€ì… ì»¬ëŸ¼ (ì¹´ë””ë„ë¦¬í‹° ë‚®ìŒ, ì„ íƒì  ì ìš©)
--    2. ë‚ ì§œ ë²”ìœ„ ê²€ìƒ‰ (ì‚¬ìš© ë¹ˆë„ì— ë”°ë¼)
--    3. ì •ë ¬ ì „ìš© ì¸ë±ìŠ¤ (ì •ë ¬ ë¹ˆë„ í™•ì¸)
--
-- âŒ ì ìš© ê¸ˆì§€
--    1. UNIQUE ì œì•½ì¡°ê±´ ìˆëŠ” ì»¬ëŸ¼ (ì¤‘ë³µ ì¸ë±ìŠ¤)
--    2. ë§¤ìš° ì‘ì€ í…Œì´ë¸” (< 1000 rows)
--    3. ê±°ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì¿¼ë¦¬
--
-- ==================================================
-- ì‘ì„±ì: Claude Code
-- ìƒì„±ì¼: 2025-11-20
-- ëª©ì : ì¸ë±ìŠ¤ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¶„ì„ ë° ì‹¤ë¬´ ì ìš© ê°€ì´ë“œ
-- ==================================================
